package ui;

import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.io.File;

import io.NeuralNetworkIO;

import javax.swing.BorderFactory;
import javax.swing.BoxLayout;
import javax.swing.JButton;
import javax.swing.JFileChooser;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JPanel;

import neuralNetwork.INeuralNetwork;
import app.InputReader;

public class NetworkSelectionPanel extends JPanel {
	private INeuralNetwork chosenNetwork;
	private JLabel chosenNetworkLabel;
	private JButton chooseNetworkButton;
	
	private void setupPanel(){
		JPanel networkPanel = new JPanel();
		networkPanel.setLayout(new BoxLayout(networkPanel, BoxLayout.X_AXIS));
		
		if (chosenNetwork == null){
			chosenNetwork = NeuralNetworkIO.readNetwork(InputReader.TRAINED_NETWORK_NAME);		
			chosenNetworkLabel = new JLabel(InputReader.TRAINED_NETWORK_NAME);
		}
		chooseNetworkButton = new JButton("Choose Different Network");
		chooseNetworkButton.addActionListener(new ButtonListener());
		
		networkPanel.setBorder(BorderFactory.createTitledBorder("Chosen Neural Network"));
		networkPanel.add(chosenNetworkLabel);
		networkPanel.add(chooseNetworkButton);
		this.getContentPane().add(networkPanel);
	}
	
	public void setNetwork(INeuralNetwork network){
		chosenNetwork = network;
	}
	
	private class ButtonListener implements ActionListener{

		@Override
		public void actionPerformed(ActionEvent evt) {
			if (evt.getSource() == chooseNetworkButton){
				JFileChooser chooser = new JFileChooser();
				chooser.setCurrentDirectory(new File("savedNetworks/customNetworks"));
				int result = chooser.showOpenDialog(NetworkSelectionPanel.this);
				
				if (result == JFileChooser.APPROVE_OPTION){
					String filePath = chooser.getSelectedFile().getAbsolutePath();
					
					if (filePath.endsWith(".ann")){
						chosenNetwork = NeuralNetworkIO.readFromFilepath(filePath);
						networkName = chooser.getSelectedFile().getName();
						chosenNetworkLabel.setText(networkName);
					}
					else JOptionPane.showMessageDialog(NetworkSelectionPanel.this, "Must select a neural network file.", "Invalid File", JOptionPane.ERROR_MESSAGE);
				}
			}
		}
		
	}
}
