package appTest;

import io.CharacterType;

import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;
import java.util.HashSet;
import java.util.Set;

import javax.imageio.ImageIO;

import neuralNetwork.MatrixBackpropTrainer;
import neuralNetwork.MatrixNeuralNetwork;
import neuralNetwork.NeuralNetwork;
import neuralNetwork.TrainingExample;
import app.MultiNetworkReader;

public class MainTest {

	public static void main(String[] args) throws IOException {		
//		INetworkIOTranslator translator = new FeatureExtractionIOTranslator();
//		translator.translateImageToNetworkInput(ImageIO.read(new File("trainingImages/ASCII/b2.jpg")));
//		translator.translateImageToNetworkInput(ImageIO.read(new File("trainingImages/ASCII/b3.jpg")));
		
		Set<TrainingExample> examples = new HashSet<TrainingExample>();
		
		float[] input1 = {1, 1};
		float[] input2 = {1, 0};
		float[] input3 = {0, 1};
		float[] input4 = {0, 0};
		
		int[] output1 = {0};
		int[] output2 = {1};
		int[] output3 = {1};
		int[] output4 = {0};
		
		examples.add(new TrainingExample(input1, output1));
		examples.add(new TrainingExample(input2, output2));
		examples.add(new TrainingExample(input3, output3));
		examples.add(new TrainingExample(input4, output4));
		
		MatrixNeuralNetwork net = new MatrixNeuralNetwork(2, 1, 3, 1, true);
		MatrixBackpropTrainer t = new MatrixBackpropTrainer(0.05f, 0.02f);
		
		t.trainWithTrainingSet(net, examples, new HashSet<TrainingExample>());
		
		float[] test1 = input3;
		float[] test2 = input4;
		
		float[] doutput1 = net.forwardPropagate(test1);
		float[] doutput2 = net.forwardPropagate(test2);
		
		System.out.println("yeaH: " + doutput1[0] + " " + doutput2[0]);
		
	//	MainTest.runApp();
	}
	
	private static void runApp() throws IOException{
		//NeuralNetwork savedNetwork = NeuralNetworkIO.readNetwork("myNetwork");
		
		//System.out.println("length: " + ((FeatureExtractionIOTranslator)t).getInputLength());
		
//		NeuralNetwork trainedNetwork1 = NetworkFactory.getTrainedNetwork(network, t, CharacterType.ASCII, new BackpropagationTrainer(0.05f, 0.02f));
//		NeuralNetwork trainedNetwork2 = NetworkFactory.getTrainedNetwork(network, t, CharacterType.ASCII2, new BackpropagationTrainer(0.05f, 0.02f));
//		NeuralNetwork trainedNetwork3 = NetworkFactory.getTrainedNetwork(network, t, CharacterType.ASCII4, new BackpropagationTrainer(0.05f, 0.02f));
//		
		BufferedImage img = ImageIO.read(new File("C:\\Users\\nredmond\\Pictures\\charTest3.png"));
		CharacterType[] types = {CharacterType.ASCII};
//		ImageReader reader = new ImageReader(trainedNetwork, t);
		
		String result = MultiNetworkReader.getTextFromImage(img, types);
		System.out.println("RESULT: " + result);
		
//		for (int i = 65; i <=90; i++){
//			char y = (char)i;
//			BufferedImage c = 
//					ImageIO.read(new File("C:\\Users\\nredmond\\Workspaces\\CapstoneNickRedmond\\Code\\Text4Less\\trainingImages\\ASCII\\" + y + ".jpg"));
//			System.out.println("this should be " + y + ": " + t.translateNetworkOutputToCharacter(network.getOutputForInput(t.translateImageToNetworkInput(c))));
//		}
	//	NeuralNetworkIO.writeNetwork(trainedNetwork, "myNetwork");
	}

	private static void testMe(NeuralNetwork network, Set<TrainingExample> set){
		
		for (TrainingExample nextExample : set){
			float[] outputs = network.forwardPropagate(nextExample.getInput());
			
			System.out.print("Desired: ");
			
			for (int i = 0; i < nextExample.getOutput().length; i++){
				System.out.print(nextExample.getOutput()[i] + " ");
			}
			
			System.out.print(" --- Actual: ");
			
			for (int i = 0; i < outputs.length; i++){
				System.out.print(outputs[i] + " ");
			}
			System.out.println();
		}
		
		System.out.println();
	}
}
